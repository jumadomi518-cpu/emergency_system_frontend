<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
   * {
     margin: 0;
     padding: 0;
     font-family: "Poppins", sans-serif;
     box-sizing: border-box;
   }
   
  
    body {
      font-family: Arial; 
      padding: 10px; 
    }
    
    h2 {
      text-align: center;
      white-space: nowrap;
      overflow: scroll;
      padding: 0.5em;
    }
    #map { 
      height: 400px; 
    }
    table { 
      width: 100%; 
      margin-top: 10px; 
    }
    td,th { 
      padding:5px; 
      border: 1px 
      solid #ccc; 
    }
  </style>
</head>
<body>

<h2>Alupe university emergency administrator.</h2>
<div id="map"></div>

<table>
  <thead>
    <tr><th>Name</th><th>Phone</th><th>Message</th><th>Action</th></tr>
  </thead>
  <tbody id="rows"></tbody>
</table>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const ws = new WebSocket("wss://campus-emergency-server.onrender.com");
const map = L.map("map").setView([0,0],2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

ws.onopen = () => ws.send(JSON.stringify({role:"admin"}));

ws.onmessage = e => {
  const m = JSON.parse(e.data);

  if(m.type==="NEW_ALERT"){
    const a = m.data;
    L.marker([a.latitude,a.longitude]).addTo(map)
      .bindPopup(a.name);

    rows.innerHTML += `
      <tr id="a${a.alertId}">
        <td>${a.name}</td>
        <td>${a.phone}</td>
        <td>${a.message||""}</td>
        <td><button onclick="resolve(${a.alertId})">Resolve</button></td>
      </tr>`;
  }

  if(m.type==="ALERT_RESOLVED"){
    const row = document.getElementById("a"+m.alertId);
    if(row) row.style.opacity = 0.5;
  }
};

function resolve(id){
  ws.send(JSON.stringify({type:"RESOLVE_ALERT", alertId:id}));
}
</script>
</body>
</html>